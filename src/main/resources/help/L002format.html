<!DOCTYPE html>
<html lang=en>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <TITLE>jam Manual--Event Stream Format</TITLE>
</HEAD>
<BODY>
<H2>L002 Event Data Format</H2>
The event data file consists of a header followed by buffers of data.
The header is 256 bytes long and the events are written out in 
buffers of 8192 bytes. The buffers are filled with events until 
another event won't fit, then they are padded with out. The last
buffer of a run is padded out with characters indicating it is 
the last buffer.

<h3>Header</h3>
The header is first in the event file is 256 bytes long.
It is the same as the Oak Ridge L002 Format header, and is generated by Jam, <em>not</em> the front end. 
<table>
<tr>
<td>Bytes</td><td>Item</td>
</tr> 
<tr><td>0-7</td>  <td>'HHIRF   '</td>
</tr>
<tr><td>8-15</td> <td>'L002    '</td>
</tr>
<tr><td>16-31</td><td>'LIST DATA       '</td>
</tr>
<tr><td>32-47</td><td>Date</td>
</tr>
<tr><td>48-127</td><td>Title</td>
</tr>
<tr><td>128-131</td><td>Run Number</td>
</tr>
<tr><td>132-139</td><td>Reserved</td>
</tr>
<tr><td>140-143</td><td>Number secondary Headers</td>
</tr>
<tr><td>144-147</td><td>Record length (bytes)</td>
</tr>
<tr><td>148-151</td><td>Block line image records</td>
</tr>
<tr><td>152-155</td><td>Record length 2 (bytes)</td>
</tr>
<tr><td>156-159</td><td>Parameters/event (ref only)</td>
</tr>
<tr><td>160-163</td><td>Data record length (bytes)</td>
</tr>
<tr><td>164-255</td><td>Reserved 2</td>
</tr>
</table>

<h3>Data</h3>
<ol>
<li>The events are written in buffers of 8192 bytes.</li>
<li>Each event is a a series of parameter identifies (2 bytes) followed by the
   data (2 bytes) for that parameter.</li>
<li>The parameter identifer is indicated by having the most significant byte
   equal to 1, event data therefore cannot have the most significant byte set.</li>
<li>Due to the format's origin in Fortran, the allowed parameter numbers starts counting at 1.</li>
<li>Events are end with an end of event marker (2 bytes) hex FFFF.</li>
<li>The last event in a buffer is followed by two hex FFF0.</li>
<li>The rest of the buffer is padded out with hex FFF0 except for
   the last buffer of a run which is padded out with hex FF03.</li>
</ol>


<table border=2>
   <caption>Typical Data Buffer Format</caption>
<tr><th scope=col>Bytes</th><th scope=col>Hex Value</th><th scope=col>Item</th><th scope=col>Comment</td>
</tr> 
<tr><td>0 - 1  </td><td>8001</td><td>Param ID =1</td><td>-</td>
</tr>
<tr><td>2 - 3  </td><td>0123</td><td>value    =123</td><td>-</td>
</tr>
<tr><td>4 - 5  </td><td>8002</td><td>Param ID =2</td><td>-</td>
</tr>
<tr><td>6 - 7  </td><td>0222</td><td>value    =222</td><td>-</td>
</tr>
<tr><td>8 - 9  </td><td>8003</td><td>Param ID =3</td><td>-</td>
</tr>
<tr><td>10 - 11</td><td>0111</td><td>value    =111</td><td>-</td>
</tr>
<tr><td>12 - 13</td><td>8004</td><td>Param ID =3</td><td>-</td>
</tr>
<tr><td>10 - 11</td><td>0321</td><td>value    =0321</td><td>-</td>
</tr>
<tr><td>. . .</td><td>-</td><td>-</td><td>-</td>
</tr>
<tr><td>X+1 - X+2</td><td>FFFF</td><td>End Event Marker</td><td>X  =event size x 4 </td>
</tr>
<tr><td>X+3 - X+4</td><td>8001</td><td>Param ID =1</td><td>Next event</td>
</tr>
<tr><td>X+5 - X+6</td><td>0234</td><td>value    =234</td><td>-</td>
</tr>
<tr><td>X+7 - X+8</td><td>8002</td><td>Param ID =2</td><td>-</td>
</tr>
<tr><td>X+9 - X+10</td><td>0134</td><td>value    =134</td><td>-</td>
</tr>
<tr><td>. . .</td><td>-</td><td>-</td><td>-</td>
</tr>
<tr><td>2X+1 - 2X+2</td><td>FFFF</td><td>End Event Marker</td><td> X=event size x 4 </td>
</tr>
<tr><td>. . .</td><td>-</td><td>-</td><td>-</td>

</tr>
<tr><td>NX+1 - NX+2</td><td>FFFF</td><td>End Event Marker</td><td> N=number events in buffer </td>
</tr>
<tr><td>NX+3 - NX+4</td><td>FFF0</td><td>Buffer Pad</td><td>or FF03 for End Run </td>
</tr>
<tr><td>NX+5 - NX+6</td><td>FFF0</td><td>Buffer Pad</td><td>or FF03 for End Run </td>
</tr>
<tr><td>NX+7 - NX+8 </td><td>FFF0</td><td>Buffer Pad</td><td>or FF03 for End Run </td>
</tr>
<tr><td>NX+9 - NX+10</td><td>FFF0</td><td>Buffer Pad</td><td>or FF03 for End Run </td>
</tr>
<tr><td>. . .</td><td>-</td><td>-</td><td>-</td>
</tr>
<tr><td>8190 - 8191   </td><td>FFF0</td><td>Buffer Pad</td><td>or FF03 for End Run  </td>
</table>
</BODY>
</html>
