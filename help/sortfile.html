<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Microsoft FrontPage 4.0">
   <title>Jam Download</title>
<link REL=STYLESHEET TYPE="text/css" HREF="manualstyle.css" TITLE="Manual Style">
<meta name="Microsoft Border" content="none, default">
</head>
<body>

<h1>
Jam User Manual</h1>

<h2>
How to write a sort routine for Jam</h2>
A sort routine for Jam is written as a Java class. A template of a sort
routine is provided for you. Following the template is the easiest way
to get a sort routine up and running (in fact that's how I do it). The sort
routine you write has to extend the <span class=jam>Jam</span> class, <code>jam.sort.SortRoutine</code>. This allows
the full flexibility of the Java language, but also requires you follow a certain syntax so that your class is a 
valid extension.
<p>A basic sort routine has 3 main sections:
<ol>
<li>
<i>The declaration section:</i> Here you declare names for the variables
representing, among other things, your histograms, gates, scalers and real-time
monitors. 
Declarations made here are visible throughout the sort routine, i.e., in all
subsequent sections.</li>

<li>
<i>The initialization section:</i> Here you initialize all your classes and intrinsic
types. You give your Histograms, Gates, and Scalers the 
properties you want, e.g.. name, size, type, and title, etc.
This automatically creates them.</li>
<li>
<i>The sort section:</i> This the part of the sort routine is called for
every event. It is where you increment Histograms and test to see if an
event is in a gate.</li>
<li>
<i>The monitor section (optional): </i>This section can be used to calculate the
return value of certain Monitor objects.</li>
</ol>
<h3>
Syntax</h3>
You must follow a certain format and Java syntax rules and to create
a sort routine that is a valid subclass of the <code>jam.sort.SortRoutine</code> class. 
Requirements needed to create a subclass of SortRoutine and some syntax rules for 
java are given. It might clearer how these requirements are implemented 
by looking at the sort class template below.&nbsp;
<ul>
<li>
Your sort routine file name must have the same name as the class name. For
example, the class <tt>MySort</tt> must reside in a file name MySort.java</li>
<li>
Your sort class must extend the Jam class <code>jam.sort.SortRoutine</code>, as
follows:
<br> <code>import jam.sort.SortRoutine;</code>
<br> <code>public class MySort extends SortRoutine</code></li>
<li>
You must have an initialization method, as follows:
<br><code>public void initialize() throws Exception{...}</code> </li>
<li>
You must have a sort method, as follows:
<br><code>public void sort(int [] eventData) throws Exception {...}</code> </li>
<li>
For offline sorting
you must define your event size with <code>setEventSize(size of eventData array)</code></li>
<li>
<i>
If required</i>, you must and also define your buffer size, with <code>BUFFER_SIZE=(#
words in buffer) </code> <i> This is not typically needed.</i></li>
</ul>

<p>
Here is the skeleton of a sort class, that is in file <code>MySort.java </code>
<br>
<pre><code>public void MySort extends SortRoutine {

    &nbsp;/*variable, histogram and gate delerations go here ... */

   public void initialization() throws Exception {
         EVENT_SIZE=5;
    &nbsp;/* initialization code goes here... */
   }

   public void sort(int[] eventdata) throws Exception {
    &nbsp;/* sort code goes here... */
   }
}</code></pre>




<h3>
Variables</h3>
Variables can either be intrinsic types (e.g., <code>int</code> or <code>float</code>)
or a class (for example <code>Histogram</code> or <code>Gate</code>). Whereas a
intrinsic variable can just be allocated a value (e.g., <code>number=4</code>),
each new instance of a class, which is called an object, must explicitly
created using the <code>new</code> keyword followed by a constructor for that
class. A constructor is the class name given with the parameters needed
to create it. For example, one constructor for histogram is <code>Histogram(name,
number, type, size, title)</code>  where you must provide the parameters: <code>name, number
type, size,</code> and <code>title</code>.

<h3>
Classes</h3>
The classes that are available for you in sort class are:
<h4>Data Classes</h4>
<dl>
   
<dt><a href="../API/jam/data/Histogram.html">Histogram</a></dt>
<dd>
A histogram is a your usual way to display data and can be one or two dimension,
and int or double.

<dt><a href="../API/jam/data/Gate.html">Gate</a></dt>
<dd>
A gate is a condition which can get interactively set.
The condition is lower and upper limits in one dimension 
or a region in two dimensions.

<dt><a href="../API/jam/data/Scaler.html">Scaler</a></dt>
<dd>
A scaler is a scaler that.

<dt><a href="../API/jam/data/DataParameter.html">DataParameter</a></dt>
<dd>
A parameter allows you to pass values to the sort routine.

<dt>
<a href="../API/jam/data/Monitor.html">Monitor</a></dt>
<dd>
A monitor is a class that allows rates int a experiment to 
be monitored.

</dl>
<h4>Electronics Configuration Classes</h4>
<dl>
   
<dt>Pre-existing instance <code>cnafCommands</code> of&nbsp; class <a href="../API/jam/sort/CamacCommands.html">CamacCommands</a></dt>
<dd>
This is a class whose methods you call to setup the CAMAC crate.&nbsp; See <a href="camaccommand.html">here</a>
for more explanation.
<dt>Pre-existing instance <code>vmeMap</code> of class <a href="../API/jam/sort/VME_Map.html">VME_Map</a></dt>

</dl>
<h3>Sort Routine Examples</h3>
<h4>CAMAC-based Acquisition Systems</h4>
<p><a href="SortTemplate1.java">Here</a> is a template of a sort routine with two histogram and one gate.
One histogram is incremented for every event while the second histogram
is only incremented if the event falls in the first histograms gate.
For <code>camacCommnands</code> the <code>c,n,a,f</code> would have to be replace by 
actual values.</p>
<p>A more complete example of a CAMAC-based sort routine may be found <a href="sortfiles/EvsDE.html">here</a>.</p>
<h4>VME-based systems using CAEN V7x5 ADC's and TDC's</h4>
<p>Here is a version of a sort routine used at LENA, modified here for
demonstration purposes:</p>
<table border="1" width="100%">
  <tr>
    <td width="50%">File</td>
    <td width="50%">Contents</td>
  </tr>
  <tr>
    <td width="50%"><a href="sortfiles/CI.java">CI.java</a></td>
    <td width="50%">Sort routine source code</td>
  </tr>
  <tr>
    <td width="50%"><a href="sortfiles/CI.PDF">CI.pdf</a></td>
    <td width="50%">Nicely formatted copy for reading</td>
  </tr>
  <tr>
    <td width="50%"><a href="sortfiles/CI.ppt">CI.ppt</a></td>
    <td width="50%">Pedagogical walkthrough of the sort routine</td>
  </tr>
</table>
<h3>Compiling your Sort Routine</h3>
<p>These instructions are for Unix-based systems, but remain essentially the
same for Windows-based systems. Let's assume you have a sort routine called <code>MySort.java</code> in the directory
<code>/home/daq/sortfiles</code>, and you copy of Jam resides in <code>/home/daq/lib</code>.
To compile it, you issue the following commands from the shell:
</p>
<ol>
  <li>cd /home/daq/sortfiles</li>
  <li><tt>javac -classpath /home/daq/lib/Jam.jar:/home/daq Mysort.java</tt><br>
  </li>
</ol>
<p>
This will create a file <code>MySort.class</code> in <code>/home/daq/sortfiles</code>. Note the
following requirements for the above to work:</p>
<ul>
  <li>The path to <code>javac</code> must be in your <code>PATH</code> variable.</li>
  <li>The first line of <code>MySort.java</code> must be <code>package
    sortfiles;</code></li>
</ul>
<hr>
<address><!-- describing variables -->Last Modified <!--webbot bot="Timestamp"
  S-Type="EDITED" S-Format="%A, %d %B %Y %H:%M:%S %Z" startspan -->Saturday, 18 January 2003 17:00:07 -0500<!--webbot bot="Timestamp" endspan i-checksum="25881" --></body>
</html>
