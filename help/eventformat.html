<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Microsoft FrontPage 4.0">
   <TITLE>jam Manual--Event Stream Format</TITLE>
   <LINK REL=STYLESHEET TYPE="text/css" HREF="manualstyle.css" TITLE="Manual Style">
<meta name="Microsoft Border" content="none, default">
</HEAD>
<BODY>
<h1>Jam User Manual</h1>
<H2>L002 Event Data Format</H2>
The event data file consists of a header followed by buffers of data.
The header is 256 bytes long and the events are written out in 
buffers of 8192 bytes. The buffers are filled with events until 
another event won't fit, then they are padded with out. The last
buffer of a run is padded out with characters indicating it is 
the last buffer.

<h3>Header</h3>
The header is first in the event file is 256 bytes long.
It is the same as the Oak Ridge L002 Format header. 
<table>
<tr>
<td>Bytes</td><td>Item</td>
</tr> 
<tr><td>0-7</td>  <td>'HHIRF   '</td>
</tr>
<tr><td>8-15</td> <td>'L002    '</td>
</tr>
<tr><td>16-31</td><td>'LIST DATA       '</td>
</tr>
<tr><td>32-47</td><td>Date</td>
</tr>
<tr><td>48-127</td><td>Title</td>
</tr>
<tr><td>128-131</td><td>Run Number</td>
</tr>
<tr><td>132-139</td><td>Reserved</td>
</tr>
<tr><td>140-143</td><td>Number secondary Headers</td>
</tr>
<tr><td>144-147</td><td>Record length (bytes)</td>
</tr>
<tr><td>148-151</td><td>Block line image records</td>
</tr>
<tr><td>152-155</td><td>Record length 2 (bytes)</td>
</tr>
<tr><td>156-159</td><td>Parameters/event (ref only)</td>
</tr>
<tr><td>160-163</td><td>Data record length (bytes)</td>
</tr>
<tr><td>164-255</td><td>Reserved 2</td>
</tr>
</table>

<h3>Data</h3>
The events are written in buffers of 8192 bytes. 
Each event is a a series of parameter identifies (2 bytes) followed by the 
data (2 bytes) for that parameter.
The parameter identifer is indicated by having the most significant byte 
equal to 1, event data therefore cannot have the most significant byte set. 
The parameter idenitifer and starts to count from 1. 
Events are end with an end of event marker (2 bytes) hex FFFF.
The last event in a buffer is followed by two hex FFF0. 
The rest of the buffer is padded out with hex FFF0 except for
the last buffer of a run which is padded out with hex FF03.
<p>
A typical buffer of a event stream is given below.
<table border=2>
<tr><td>Bytes</td><td>Hex Value</td><td>Item </td><td>Comment</td>
</tr> 
<tr><td>0 - 1  </td><td>8001</td><td>Param ID =1</td><td>-</td>
</tr>
<tr><td>2 - 3  </td><td>0123</td><td>value    =123</td><td>-</td>
</tr>
<tr><td>4 - 5  </td><td>8002</td><td>Param ID =2</td><td>-</td>
</tr>
<tr><td>6 - 7  </td><td>0222</td><td>value    =222</td><td>-</td>
</tr>
<tr><td>8 - 9  </td><td>8003</td><td>Param ID =3</td><td>-</td>
</tr>
<tr><td>10 - 11</td><td>0111</td><td>value    =111</td><td>-</td>
</tr>
<tr><td>12 - 13</td><td>8004</td><td>Param ID =3</td><td>-</td>
</tr>
<tr><td>10 - 11</td><td>0321</td><td>value    =0321</td><td>-</td>
</tr>
<tr><td>. . .</td><td>-</td><td>-</td><td>-</td>
</tr>
<tr><td>X+1 - X+2</td><td>FFFF</td><td>End Event Marker</td><td>X  =event size x 4 </td>
</tr>
<tr><td>X+3 - X+4</td><td>8001</td><td>Param ID =1</td><td>Next event</td>
</tr>
<tr><td>X+5 - X+6</td><td>0234</td><td>value    =234</td><td>-</td>
</tr>
<tr><td>X+7 - X+8</td><td>8002</td><td>Param ID =2</td><td>-</td>
</tr>
<tr><td>X+9 - X+10</td><td>0134</td><td>value    =134</td><td>-</td>
</tr>
<tr><td>. . .</td><td>-</td><td>-</td><td>-</td>
</tr>
<tr><td>2xX+1 - 2xX+2</td><td>FFFF</td><td>End Event Marker</td><td> X=event size x 4 </td>
</tr>
<tr><td>. . .</td><td>-</td><td>-</td><td>-</td>

</tr>
<tr><td>NxX+1 - NxX+2</td><td>FFFF</td><td>End Event Marker</td><td> N=number events in buffer </td>
</tr>
<tr><td>NxX+3 - NxX+4</td><td>FFF0</td><td>Buffer End</td><td>-</td>
</tr>
<tr><td>NxX+5 - NxX+6</td><td>FFF0</td><td>Buffer End</td><td>-</td>
</tr>
<tr><td>NxX+7 - NxX+8 </td><td>FFF0</td><td>Buffer Pad</td><td>or FF03 for End Run </td>
</tr>
<tr><td>NxX+9 - NxX+10</td><td>FFF0</td><td>Buffer Pad</td><td>or FF03 for End Run </td>
</tr>
<tr><td>. . .</td><td>-</td><td>-</td><td>-</td>
</tr>
<tr><td>8190 - 8191   </td><td>FFF0</td><td>Buffer Pad</td><td>or FF03 for End Run  </td>
</table>
                                                  
&nbsp;</BODY>
</HTML>
